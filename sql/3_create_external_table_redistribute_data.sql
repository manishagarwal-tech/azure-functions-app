IF NOT EXISTS (SELECT * FROM sys.external_file_formats WHERE name = 'SynapseParquetFormat') 
    CREATE EXTERNAL FILE FORMAT [SynapseParquetFormat] 
    WITH ( FORMAT_TYPE = PARQUET)
GO

IF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = '{storage_account_name}_dfs_core_windows_net') 
    CREATE EXTERNAL DATA SOURCE [{storage_account_name}_dfs_core_windows_net] 
    WITH (
        LOCATION   = 'abfss://{container_name}@{storage_account_name}.dfs.core.windows.net',
        CREDENTIAL = gen2_credentails
    )
GO

-- fix in future.
-- DROP EXTERNAL TABLE IF EXISTS dbo.{table_name};
-- GO

CREATE EXTERNAL TABLE dbo.{table_name} (
    [FIPSCode] nvarchar(4000),
    [DPID] nvarchar(4000),
    [PID] nvarchar(4000),
    [APN] nvarchar(4000),
    [DuplicateAPN] nvarchar(4000),
    [OldAPN] nvarchar(4000),
    [RawPropertyHouseAlpha] nvarchar(4000),
    [PropertyFullStreetAddress] nvarchar(4000),
    [PropertyCityName] nvarchar(4000),
    [PropertyState] nvarchar(4000),
    [PropertyZipCode] nvarchar(4000),
    [PropertyUnitNumber] nvarchar(4000),
    [PropertyHouseNumber] nvarchar(4000),
    [PropertyStreetDirectionLeft] nvarchar(4000),
    [PropertyStreetName] nvarchar(4000),
    [PropertyStreetSuffix] nvarchar(4000),
    [PropertyStreetDirectionRight] nvarchar(4000),
    [PropertyAddressLatitude] nvarchar(4000),
    [PropertyAddressLongitude] nvarchar(4000),
    [AssesseeOwnerName] nvarchar(4000),
    [2ndAssesseeOwnerNameDBA] nvarchar(4000),
    [AssesseeMailFullStreetAddress] nvarchar(4000),
    [OwnerOccupiedResidential] nvarchar(4000),
    [AssessedLandValue] nvarchar(4000),
    [PriorSalesPrice] nvarchar(4000),
    [TaxAmount] nvarchar(4000),
    [TaxYear] nvarchar(4000),
    [LegalBriefDescription] nvarchar(4000),
    [LegalLotNumber] nvarchar(4000),
    [LegalSubdivisionName] nvarchar(4000),
    [LegalTractNumber] nvarchar(4000),
    [StandardizedLandUseCode] nvarchar(4000),
    [CountyLandUseDescription] nvarchar(4000),
    [Zoning] nvarchar(4000),
    [LotSizeorArea] float,
    [LotSizeAreaUnit] nvarchar(4000),
    [BuildingArea] nvarchar(4000),
    [YearBuilt] nvarchar(4000),
    [NoOfBuildings] nvarchar(4000),
    [NoOfStories] nvarchar(4000),
    [NumberofUnits] nvarchar(4000),
    [NumberofBedrooms] nvarchar(4000),
    [NumberofBaths] nvarchar(4000),
    [GarageTypeParking] nvarchar(4000),
    [GarageParkingNumOfCars] nvarchar(4000),
    [Pool] nvarchar(4000),
    [Style] nvarchar(4000),
    [LatestValidRecordingDate] nvarchar(4000),
    [LatestValidPrice] nvarchar(4000),
    [AltOldAPNIndicator] nvarchar(4000),
    [LotSizeSquareFeet] nvarchar(4000),
    [BuildingArea1] nvarchar(4000),
    [BuildingArea2] nvarchar(4000),
    [EffectiveYearBuilt] nvarchar(4000),
    [LotSizeAcres] nvarchar(4000),
    [SchoolTaxDistrict1] nvarchar(4000),
    [BuildingCondition] nvarchar(4000),
    [AssesseeMailCityName] nvarchar(4000),
    [AssesseeMailStateCode] nvarchar(4000),
    [AssesseeMailZipCode] nvarchar(4000),
    [PriorSaleDate] nvarchar(4000),
    [C_OLDAPN] nvarchar(4000),
    [calc_address_asmt] nvarchar(4000),
    [calc_LotSizeorAreaInSqFt] float,
    [calc_LotSizeorAreaInAcre] float,
    [characteristics_haswaterview] bit,
    [characteristics_ishistoric] nvarchar(4000),
    [characteristics_numberoflots] nvarchar(4000),
    [characteristics_numberofunitstotal] bigint,
    [characteristics_physicaldockslipconveys] nvarchar(4000),
    [characteristics_waterfrontageinfeet] nvarchar(4000),
    [closing_closeprice] float,
    [contract_listingcontractdate] nvarchar(4000),
    [contract_listingterms] nvarchar(4000),
    [contract_originallistprice] float,
    [contract_speciallistingconditions] nvarchar(4000),
    [core_id] nvarchar(4000),
    [core_uid] nvarchar(4000),
    [core_cumulativedaysonmarket] bigint,
    [core_currentprice] bigint,
    [core_daysonmarket] bigint,
    [core_listprice] float,
    [core_originalentrytimestamp] nvarchar(4000),
    [core_modificationtimestamp] nvarchar(4000),
    [core_propertysubtype] nvarchar(4000),
    [core_propertytype] nvarchar(4000),
    [core_standardstatus] nvarchar(4000),
    [core_sourcebusinesspartner] nvarchar(4000),
    [dates_cancellationdate] nvarchar(4000),
    [dates_closedate] nvarchar(4000),
    [dates_endingdate] nvarchar(4000),
    [dates_offmarketdate] nvarchar(4000),
    [dates_onmarketdate] nvarchar(4000),
    [dates_pendingtimestamp] nvarchar(4000),
    [dates_pricechangetimestamp] nvarchar(4000),
    [dates_purchasecontractdate] nvarchar(4000),
    [dates_withdrawndate] nvarchar(4000),
    [features_basement_list] nvarchar(4000),
    [features_cooling_list] nvarchar(4000),
    [features_dock_typeandfeatures] nvarchar(4000),
    [features_exterior_list] nvarchar(4000),
    [features_fencing_list] nvarchar(4000),
    [features_fireplace_list] nvarchar(4000),
    [features_fireplace_total] bigint,
    [features_frontagetype] nvarchar(4000),
    [features_heating_list] nvarchar(4000),
    [features_interior_list] nvarchar(4000),
    [features_laundry_list] nvarchar(4000),
    [features_lot_list] nvarchar(4000),
    [features_patioandporch_list] nvarchar(4000),
    [features_pool_isprivate] bit,
    [features_pool_list] nvarchar(4000),
    [features_sewer_list] nvarchar(4000),
    [features_spa_list] nvarchar(4000),
    [features_view_hasfeature] bit,
    [features_view_list] nvarchar(4000),
    [features_wateraccess_hasfeature] bit,
    [features_waterfront_hasfeature] bit,
    [features_waterfront_list] nvarchar(4000),
    [green_energyefficient] nvarchar(4000),
    [green_energygeneration] nvarchar(4000),
    [green_remarks] nvarchar(4000),
    [homeownersassociation_hasassociation] bit,
    [location_address_city] nvarchar(4000),
    [location_address_countyorparish] nvarchar(4000),
    [location_address_postalcode] nvarchar(4000),
    [location_address_stateorprovince] nvarchar(4000),
    [location_address_streetdirprefix] nvarchar(4000),
    [location_address_streetdirsuffix] nvarchar(4000),
    [location_address_streetname] nvarchar(4000),
    [location_address_unparsedaddress] nvarchar(4000),
    [location_address_streetnumber] nvarchar(4000),
    [location_address_streetnumbernumeric] bigint,
    [location_address_streetsuffix] nvarchar(4000),
    [location_address_streetsuffixmodifier] nvarchar(4000),
    [location_address_unitnumber] nvarchar(4000),
    [location_area_federalfloodzone] nvarchar(4000),
    [location_area_mlsarea_major] nvarchar(4000),
    [location_area_mlsarea_minor] nvarchar(4000),
    [location_area_subdivision_name] nvarchar(4000),
    [location_gis_latitude] float,
    [location_gis_longitude] float,
    [lotsize_area] float,
    [lotsize_dimensions_description] nvarchar(4000),
    [lotsize_units] nvarchar(4000),
    [media_photoscount] bigint,
    [parking_features_list] nvarchar(4000),
    [parking_spaces_carport] float,
    [parking_spaces_open] float,
    [parking_spaces_total] nvarchar(4000),
    [parking_spaces_uncovered] nvarchar(4000),
    [remarks_disclosures] nvarchar(4000),
    [remarks_private] nvarchar(4000),
    [remarks_propertycondition] nvarchar(4000),
    [remarks_public] nvarchar(4000),
    [showing_lockbox_location] nvarchar(4000),
    [showing_lockbox_type] nvarchar(4000),
    [structure_abovegrade_finishedarea_value] float,
    [structure_abovegrade_unfinishedarea_value] nvarchar(4000),
    [structure_agedescription] nvarchar(4000),
    [structure_architecturalstyle] nvarchar(4000),
    [structure_basement_finishedpercent] nvarchar(4000),
    [structure_bathrooms_full] bigint,
    [structure_bathrooms_half] bigint,
    [structure_bathrooms_onequarter] nvarchar(4000),
    [structure_bathrooms_threequarter] bigint,
    [structure_bathrooms_total] bigint,
    [structure_bedrooms_total] bigint,
    [structure_belowgrade_finishedarea_value] float,
    [structure_belowgrade_unfinishedarea_value] float,
    [structure_builder_name] nvarchar(4000),
    [structure_building_area_value] float,
    [structure_commonwalls] nvarchar(4000),
    [structure_flooring_list] nvarchar(4000),
    [structure_foundation_details] nvarchar(4000),
    [structure_garage_hasgarage] bit,
    [structure_garage_spaces] float,
    [structure_hasattachedgarage] bit,
    [structure_haspropertyattached] bit,
    [structure_isnewconstruction] bit,
    [structure_livingarea_source] nvarchar(4000),
    [structure_livingarea_value] float,
    [structure_numberofbuildings] nvarchar(4000),
    [structure_otherstructures] nvarchar(4000),
    [structure_stories] bigint,
    [structure_yearbuilt_effective] nvarchar(4000),
    [structure_yearbuilt_source] nvarchar(4000),
    [structure_yearbuilt_year] bigint,
    [structure_builder_model] nvarchar(4000),
    [taxes_additionalparcels_description] nvarchar(4000),
    [taxes_additionalparcels_hasmultiplelots] bit,
    [taxes_annualamount] float,
    [taxes_improvementassessment_amount] nvarchar(4000),
    [taxes_landassessment_amount] nvarchar(4000),
    [taxes_parcelnumber] nvarchar(4000),
    [taxes_zoning_code] nvarchar(4000),
    [uses_land_code] nvarchar(4000),
    [utilities_water_watersource] nvarchar(4000),
    [location_address_countyorparishcode] nvarchar(4000),
    [showing_contact_name] nvarchar(4000),
    [showing_contact_phone] nvarchar(4000),
    [showing_instructions] nvarchar(4000),
    [occupant_name] nvarchar(4000),
    [occupant_type] nvarchar(4000),
    [calc_bathroom_mls] nvarchar(4000),
    [calc_address_mls] nvarchar(4000),
    [calc_lot_size_sqft] float,
    [calc_lot_size_acre] float,
    [calc_brokers_mlsid] nvarchar(4000),
    [calc_brokers_name] nvarchar(4000),
    [calc_brokers_participatingagents_firstname] nvarchar(4000),
    [calc_brokers_participatingagents_lastname] nvarchar(4000),
    [calc_brokers_participatingagents_mlsid] nvarchar(4000),
    [calc_homeownersassociation_associations_amenities] nvarchar(4000),
    [calc_homeownersassociation_associations_fee_amount] nvarchar(4000),
    [calc_homeownersassociation_associations_fee_frequency] nvarchar(4000),
    [calc_homeownersassociation_associations_fee_includes] nvarchar(4000),
    [calc_homeownersassociation_associations_name] nvarchar(4000),
    [calc_schools_district] nvarchar(4000),
    [calc_schools_name] nvarchar(4000),
    [join_type] nvarchar(4000),
    [square_feet_variance] float,
    [bedroom_variance] float,
    [bathroom_variance] float,
    [lotsize_square_feet_variance] float,
    [lotsize_acre_variance] float,
    [year_built_variance] float,
    [garage_spaces_variance] float,
    [numberofunits_variance] float,
    [numberofbuildings_variance] float,
    [numberofstories_variance] float,
    [calc_county_name] nvarchar(4000),
    [DPID_core_uid] nvarchar(4000),
    [calc_latest_listing_flag] nvarchar(4000),
    [calc_address_and_listing_date] nvarchar(4000),
    [reliant_area] nvarchar(4000),
    [reliant_areas] varchar(255),
    [reliant_areas_description] varchar(255)
)
WITH (
    LOCATION = '{location}',
    DATA_SOURCE = [{storage_account_name}_dfs_core_windows_net],
    FILE_FORMAT = [SynapseParquetFormat]
)
GO